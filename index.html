<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F34 Community Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top left, #1a1c2c, #0d0e14);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-download {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .icon-badge {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            color: #60a5fa;
        }

        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: rgba(20, 22, 35, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div id="ban-message"
        class="hidden fixed inset-0 z-[100] bg-black flex items-center justify-center text-center p-8">
        <div class="max-w-md">
            <h1 class="text-6xl font-bold text-red-500 mb-6">BANNED</h1>
            <p id="t-banned-text" class="text-2xl text-white mb-8">You have been banned from this website.</p>
            <div id="ban-expiry" class="text-slate-400 font-mono"></div>
            <button onclick="signOut(auth)"
                class="mt-12 px-8 py-3 rounded-xl glass hover:bg-white/10 transition-colors">Logout</button>
        </div>
    </div>

    <div id="main-content" class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-6">
            <div>
                <h1
                    class="text-4xl font-bold text-white bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
                    F34 Community</h1>
                <p id="t-subtitle" class="text-slate-400 mt-2">Discover and download shared configurations</p>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex flex-wrap glass p-1 rounded-xl max-w-[280px] md:max-w-none">
                    <button onclick="setLang('en')" id="lang-en"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">EN</button>
                    <button onclick="setLang('ko')" id="lang-ko"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">KO</button>
                    <button onclick="setLang('jp')" id="lang-jp"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">JP</button>
                    <button onclick="setLang('cn')" id="lang-cn"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">CN</button>
                    <button onclick="setLang('es')" id="lang-es"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">ES</button>
                    <button onclick="setLang('fr')" id="lang-fr"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">FR</button>
                    <button onclick="setLang('de')" id="lang-de"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">DE</button>
                    <button onclick="setLang('ru')" id="lang-ru"
                        class="px-2 py-1 rounded-lg text-[10px] font-bold transition-all">RU</button>
                </div>
                <button onclick="openSupportModal()" id="t-support"
                    class="px-6 py-2 rounded-lg glass hover:bg-white/10 transition-colors text-sm">Support</button>
                <a href="admin.html" id="t-admin-panel"
                    class="hidden px-6 py-2 rounded-lg glass hover:bg-white/10 transition-colors text-sm">Admin
                    Panel</a>
                <button id="auth-btn"
                    class="px-6 py-2 rounded-lg glass hover:bg-white/10 transition-colors text-sm">Login with
                    Google</button>
            </div>
        </header>

        <div class="mb-8">
            <div id="category-filter" class="flex flex-wrap gap-2">
                <!-- Categories injected via JS -->
            </div>
        </div>

        <div id="config-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="t-loading" class="col-span-full glass p-12 text-center text-xl animate-pulse">
                Loading configurations...
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-backdrop">
        <div class="modal-content w-full max-w-3xl max-h-[90vh] rounded-3xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-white/10 flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl font-bold">Configuration Details</h2>
                <button onclick="closeModal()" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div id="modal-body" class="p-8 overflow-y-auto custom-scrollbar">
                <!-- Content injected via JS -->
            </div>
            <div class="p-6 border-t border-white/10 flex justify-end gap-4">
                <button onclick="closeModal()" id="t-modal-close"
                    class="px-6 py-2 rounded-xl glass hover:bg-white/10 transition-colors">Close</button>
                <button id="modal-download-btn"
                    class="btn-download px-8 py-2 rounded-xl font-bold text-white transition-transform active:scale-95">Download</button>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="support-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-backdrop">
        <div class="modal-content w-full max-w-xl rounded-3xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-white/10 flex justify-between items-center">
                <h2 id="t-support-title" class="text-2xl font-bold">Customer Center</h2>
                <button onclick="closeSupportModal()" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-8 flex flex-col gap-6">
                <p id="t-support-desc" class="text-slate-400 text-sm">Please describe your issue or request. Our team
                    will review it as soon as possible.</p>
                <textarea id="support-message" rows="6"
                    class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-sm focus:outline-none focus:border-blue-500 custom-scrollbar"
                    placeholder="Enter your message here..."></textarea>
                <button onclick="submitTicket()" id="t-support-submit"
                    class="btn-download w-full py-4 rounded-2xl font-bold text-white transition-transform active:scale-95">Submit
                    Ticket</button>
            </div>
        </div>
    </div>

    <script type="module">
        const log = (msg) => console.log(`[F34] ${msg}`);

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { initializeFirestore, collection, query, where, onSnapshot, getDocs, doc, getDoc, updateDoc, increment, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA827pUzqfTpGpGbT9uKXKEjZo3hYl5ENo",
            authDomain: "f34-di.firebaseapp.com",
            projectId: "f34-di",
            storageBucket: "f34-di.firebasestorage.app",
            messagingSenderId: "660590227115",
            appId: "1:660590227115:web:0f1ca3aa9464f2406c11ee"
        };

        // --- Global State ---
        let db, auth, provider;
        let currentUser = null;
        let mcAccount = null;
        let currentCategory = 'all';
        let allConfigs = [];
        let dataLoaded = false;
        let currentLang = localStorage.getItem('f34_lang') || 'en';

        const CATEGORIES = ["Adventure", "Horror", "Decoration", "Economy", "Equipment", "Food", "Game Mechanics", "Library", "Magic", "Management", "Minigame", "Mobs", "Optimization", "Social", "Storage", "Technology", "Transportation", "Utility", "World Gen", "General", "Convenience"];

        const i18n = {
            en: {
                subtitle: "Discover and download shared configurations", adminPanel: "Admin Panel", login: "Login with Google", logout: "Logout", linkMod: "Link Minecraft (Login in Mod)", loggedInAs: "Logged in as", all: "All", loading: "Loading configurations...", details: "Details", download: "Download", link: "Link", loginToDownload: "Login", noConfigs: "No configurations found yet.", noResults: "No results in this category.", modalTitle: "Configuration Details", modalClose: "Close", info: "Information", author: "Author", category: "Category", downloads: "Downloads", description: "Description", buttons: "Buttons", raw: "Raw Configuration Data", noButtons: "No buttons defined.", noDesc: "No description provided.", loginAlert: "Please login with Google.", linkAlert: "Please link Minecraft in the mod first.",
                bannedText: "You have been banned from this website.", support: "Support", supportTitle: "Customer Center", supportDesc: "Please describe your issue or request. Our team will review it as soon as possible.", supportSubmit: "Submit Ticket", supportSuccess: "Ticket submitted successfully!", supportError: "Failed to submit ticket.",
                categories: { Adventure: "Adventure", Horror: "Horror", Decoration: "Decoration", Economy: "Economy", Equipment: "Equipment", Food: "Food", "Game Mechanics": "Game Mechanics", Library: "Library", Magic: "Magic", Management: "Management", Minigame: "Minigame", Mobs: "Mobs", Optimization: "Optimization", Social: "Social", Storage: "Storage", Technology: "Technology", Transportation: "Transportation", Utility: "Utility", "World Gen": "World Gen", General: "General", Convenience: "Convenience" }
            },
            ko: {
                subtitle: "공유된 설정을 탐색하고 다운로드하세요", adminPanel: "관리자 패널", login: "Google로 로그인", logout: "로그아웃", linkMod: "마인크래프트 연결 (모드에서 로그인)", loggedInAs: "로그인됨:", all: "전체", loading: "설정을 불러오는 중...", details: "상세 정보", download: "다운로드", link: "연결 필요", loginToDownload: "로그인", noConfigs: "아직 등록된 설정이 없습니다.", noResults: "이 카테고리에 결과가 없습니다.", modalTitle: "설정 상세 정보", modalClose: "닫기", info: "정보", author: "제작자", category: "카테고리", downloads: "다운로드 수", description: "설명", buttons: "버튼 목록", raw: "원본 설정 데이터", noButtons: "정의된 버튼이 없습니다.", noDesc: "설명이 없습니다.", loginAlert: "Google 로그인이 필요합니다.", linkAlert: "모드에서 먼저 마인크래프트 계정을 연결해 주세요.",
                bannedText: "당신은 차단 되었습니다.", support: "고객 센터", supportTitle: "고객 센터", supportDesc: "문의 사항이나 요청 사항을 입력해 주세요. 운영진이 확인 후 조치하겠습니다.", supportSubmit: "문의 제출", supportSuccess: "문의가 성공적으로 제출되었습니다!", supportError: "문의 제출에 실패했습니다.",
                categories: { Adventure: "모험", Horror: "공포", Decoration: "장식", Economy: "경제", Equipment: "장비", Food: "음식", "Game Mechanics": "게임 메커니즘", Library: "라이브러리", Magic: "마법", Management: "관리", Minigame: "미니게임", Mobs: "몹", Optimization: "최적화", Social: "소셜", Storage: "저장", Technology: "기술", Transportation: "이동수단", Utility: "유틸리티", "World Gen": "월드 생성", General: "일반", Convenience: "편의성" }
            }
        };

        // --- UI Functions ---
        window.setLang = (lang) => {
            currentLang = lang;
            localStorage.setItem('f34_lang', lang);
            updateUI();
        };

        function updateUI() {
            const t = i18n[currentLang] || i18n.en;
            document.querySelectorAll('[id^="t-"]').forEach(el => {
                const key = el.id.replace('t-', '').replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                if (t[key]) el.textContent = t[key];
            });

            const authBtn = document.getElementById('auth-btn');
            if (authBtn) {
                if (!currentUser) authBtn.textContent = t.login;
                else if (!mcAccount) authBtn.textContent = t.linkMod;
            }

            ['lang-en', 'lang-ko', 'lang-jp', 'lang-cn', 'lang-es', 'lang-fr', 'lang-de', 'lang-ru'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const lang = id.split('-')[1];
                    el.className = `px-2 py-1 rounded-lg text-[10px] font-bold transition-all ${currentLang === lang ? 'bg-blue-500 text-white' : 'hover:bg-white/10'}`;
                }
            });

            renderCategories();
            renderConfigs();
        }

        function renderCategories() {
            const t = i18n[currentLang] || i18n.en;
            const filterContainer = document.getElementById('category-filter');
            if (!filterContainer) return;
            filterContainer.innerHTML = '';

            const allBtn = document.createElement('button');
            allBtn.className = `filter-btn px-4 py-2 rounded-lg glass text-[10px] font-bold uppercase tracking-wider transition-all ${currentCategory === 'all' ? 'active' : ''}`;
            allBtn.textContent = t.all;
            allBtn.onclick = () => window.setFilter('all');
            filterContainer.appendChild(allBtn);

            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `filter-btn px-4 py-2 rounded-lg glass text-[10px] font-bold uppercase tracking-wider transition-all ${currentCategory === cat ? 'active' : ''}`;
                btn.textContent = t.categories[cat] || cat;
                btn.onclick = () => window.setFilter(cat);
                filterContainer.appendChild(btn);
            });
        }

        window.setFilter = (cat) => {
            currentCategory = cat;
            renderCategories();
            renderConfigs();
        }

        function renderConfigs() {
            if (!dataLoaded) return;
            const t = i18n[currentLang] || i18n.en;
            const configList = document.getElementById('config-list');
            if (!configList) return;

            const filtered = currentCategory === 'all' ? allConfigs : allConfigs.filter(c => c.category === currentCategory);
            if (filtered.length === 0) {
                configList.innerHTML = `<div class="col-span-full glass p-12 text-center text-xl">${allConfigs.length === 0 ? t.noConfigs : t.noResults}</div>`;
                return;
            }
            configList.innerHTML = '';
            filtered.forEach((data) => {
                const div = document.createElement('div');
                div.className = 'glass p-6 card-hover flex flex-col justify-between';
                let btnSummary = '';
                try {
                    const config = JSON.parse(data.config_json);
                    if (config.buttons) {
                        btnSummary = `<div class="flex flex-wrap gap-2 mt-4">
                            ${config.buttons.slice(0, 4).map(b => `<span class="icon-badge px-2 py-1 rounded text-[10px]">${b.name || 'Button'}</span>`).join('')}
                        </div>`;
                    }
                } catch (e) { }
                div.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">${data.name || 'Untitled'}</h3>
                                <span class="text-[10px] text-blue-400 font-bold uppercase tracking-wider">${t.categories[data.category] || data.category || t.categories.General}</span>
                            </div>
                            <span class="text-[10px] opacity-40 font-mono">${data.downloads || 0} DLs</span>
                        </div>
                        <p class="text-slate-400 text-xs mt-1">by ${data.author ? data.author.split('@')[0] : 'Unknown'}</p>
                        <p class="mt-4 text-sm text-slate-300 line-clamp-2">"${data.description || t.noDesc}"</p>
                        ${btnSummary}
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button onclick="showDetails('${data.id}')" class="flex-1 py-3 rounded-xl glass font-bold hover:bg-white/10 transition-colors">${t.details}</button>
                        <button onclick="handleDownload('${data.id}')" class="btn-download flex-1 py-3 rounded-xl font-bold text-white transition-transform active:scale-95 ${(!currentUser || !mcAccount) ? 'opacity-50 cursor-not-allowed' : ''}">${(currentUser && mcAccount) ? t.download : (currentUser ? t.link : t.loginToDownload)}</button>
                    </div>
                `;
                configList.appendChild(div);
            });
        }

        window.showDetails = (id) => {
            const data = allConfigs.find(c => c.id === id);
            if (!data) return;
            const t = i18n[currentLang] || i18n.en;
            const modal = document.getElementById('details-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalDownloadBtn = document.getElementById('modal-download-btn');
            modalTitle.textContent = t.modalTitle;
            let configObj = {};
            try { configObj = JSON.parse(data.config_json); } catch (e) { }
            modalBody.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-xs uppercase tracking-widest opacity-40 font-bold mb-4">${t.info}</h4>
                        <div class="space-y-4">
                            <div><div class="text-[10px] opacity-40">${t.author}</div><div class="font-semibold text-blue-400">${data.author || 'Unknown'}</div></div>
                            <div><div class="text-[10px] opacity-40">${t.category}</div><div class="font-semibold">${t.categories[data.category] || data.category || t.categories.General}</div></div>
                            <div><div class="text-[10px] opacity-40">${t.downloads}</div><div class="font-semibold">${data.downloads || 0}</div></div>
                        </div>
                        <h4 class="text-xs uppercase tracking-widest opacity-40 font-bold mt-8 mb-4">${t.description}</h4>
                        <p class="text-slate-300 leading-relaxed">"${data.description || t.noDesc}"</p>
                    </div>
                    <div>
                        <h4 class="text-xs uppercase tracking-widest opacity-40 font-bold mb-4">${t.buttons} (${configObj.buttons ? configObj.buttons.length : 0})</h4>
                        <div class="space-y-3">
                            ${(configObj.buttons || []).map(btn => `
                                <div class="glass p-3 rounded-xl border border-white/5">
                                    <div class="flex items-center gap-2 mb-1"><span class="text-sm font-bold">${btn.name || 'Unnamed Button'}</span></div>
                                    <div class="text-[10px] font-mono opacity-50 break-all">${btn.command || 'No command'}</div>
                                </div>
                            `).join('')}
                            ${(!configObj.buttons || configObj.buttons.length === 0) ? `<div class="opacity-30 italic text-sm">${t.noButtons}</div>` : ''}
                        </div>
                    </div>
                </div>
                <div class="mt-8">
                    <details class="group">
                        <summary class="text-xs uppercase tracking-widest opacity-40 font-bold cursor-pointer hover:opacity-100 transition-opacity flex items-center gap-2">
                            ${t.raw}
                            <svg class="w-3 h-3 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <pre class="mt-4 p-4 rounded-xl bg-black/40 text-[10px] font-mono overflow-x-auto border border-white/5 text-blue-300">${JSON.stringify(configObj, null, 2)}</pre>
                    </details>
                </div>
            `;
            modalDownloadBtn.textContent = t.download;
            modalDownloadBtn.onclick = () => window.handleDownload(id);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        window.closeModal = () => {
            document.getElementById('details-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        };

        window.handleDownload = async (id) => {
            const t = i18n[currentLang] || i18n.en;
            if (!currentUser) { alert(t.loginAlert); return; }
            if (!mcAccount) { alert(t.linkAlert); return; }
            try {
                const docRef = doc(db, "shared_configs", id);
                const snap = await getDoc(docRef);
                if (!snap.exists()) return;
                const data = snap.data();
                const blob = new Blob([data.config_json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${data.name.replaceAll(' ', '_')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                await updateDoc(docRef, { downloads: increment(1) });
            } catch (e) { alert("Download failed."); }
        };

        // --- Support Functions ---
        window.openSupportModal = () => {
            const t = i18n[currentLang] || i18n.en;
            if (!currentUser) { alert(t.loginAlert); return; }
            document.getElementById('support-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        window.closeSupportModal = () => {
            document.getElementById('support-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        };

        window.submitTicket = async () => {
            const t = i18n[currentLang] || i18n.en;
            const msg = document.getElementById('support-message').value.trim();
            if (!msg) return;
            try {
                await addDoc(collection(db, "support_tickets"), {
                    email: currentUser.email,
                    mc_name: mcAccount ? mcAccount.mc_name : 'Unknown',
                    message: msg,
                    timestamp: Date.now()
                });
                alert(t.supportSuccess);
                document.getElementById('support-message').value = '';
                closeSupportModal();
            } catch (e) { alert(t.supportError); }
        };

        // --- Firebase Logic ---
        try {
            const app = initializeApp(firebaseConfig);
            db = initializeFirestore(app, { experimentalForceLongPolling: true });
            auth = getAuth(app);
            provider = new GoogleAuthProvider();

            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                const t = i18n[currentLang] || i18n.en;
                const authBtn = document.getElementById('auth-btn');
                const adminPanelBtn = document.getElementById('t-admin-panel');
                const banMessage = document.getElementById('ban-message');
                const mainContent = document.getElementById('main-content');

                if (user) {
                    try {
                        const userDoc = await getDoc(doc(db, "users", user.email));
                        if (userDoc.exists()) {
                            mcAccount = userDoc.data();

                            // Check for ban
                            if (mcAccount.ban_until && mcAccount.ban_until > Date.now()) {
                                banMessage.classList.remove('hidden');
                                mainContent.classList.add('hidden');
                                const expiry = new Date(mcAccount.ban_until).toLocaleString();
                                document.getElementById('ban-expiry').textContent = `Ban expires: ${expiry}`;
                                return;
                            } else {
                                banMessage.classList.add('hidden');
                                mainContent.classList.remove('hidden');
                            }

                            if (adminPanelBtn && mcAccount.mc_name === 'minseokkangfox') adminPanelBtn.classList.remove('hidden');
                            if (authBtn) {
                                authBtn.innerHTML = `<div class="flex items-center gap-3">
                                    <img src="https://mc-heads.net/avatar/${mcAccount.mc_name}/32" class="w-8 h-8 rounded border border-white/20" alt="Skin">
                                    <div class="text-left"><div class="text-[10px] opacity-50 leading-none">${t.loggedInAs}</div><div class="font-bold">${mcAccount.mc_name}</div></div>
                                </div>`;
                            }
                        } else {
                            if (authBtn) authBtn.textContent = t.linkMod;
                        }
                    } catch (e) { log("Auth Doc Error: " + e.message); }
                } else {
                    if (authBtn) authBtn.textContent = t.login;
                    if (adminPanelBtn) adminPanelBtn.classList.add('hidden');
                    banMessage.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                }
                updateUI();
            });

            if (authBtn) {
                authBtn.onclick = async () => {
                    if (currentUser) {
                        if (confirm(i18n[currentLang].logout + "?")) signOut(auth);
                    } else {
                        try {
                            await signInWithPopup(auth, provider).catch(async (err) => {
                                if (['auth/popup-blocked', 'auth/popup-closed-by-user', 'auth/cancelled-popup-request'].includes(err.code)) {
                                    await signInWithRedirect(auth, provider);
                                } else throw err;
                            });
                        } catch (e) { alert("Login failed: " + e.message); }
                    }
                };
            }

            const q = query(collection(db, "shared_configs"), where("status", "==", "approved"));
            onSnapshot(q, (snap) => {
                allConfigs = [];
                snap.forEach(doc => allConfigs.push({ id: doc.id, ...doc.data() }));
                dataLoaded = true;
                renderConfigs();
            });

            updateUI();
        } catch (e) { log("Init Error: " + e.message); }
    </script>
</body>

</html>
